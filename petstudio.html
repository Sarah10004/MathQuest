<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>펫 스튜디오 – MathQuest</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root{
    --ink:#0f172a; --muted:#64748b; --card:#ffffff;
    --indigo:#4f46e5; --mint:#10b981; --mint2:#22d3c5; --pink:#ff4fa0; --amber:#f59e0b;
  }
  body{background:linear-gradient(180deg,#fff7fb 0%,#f0f8ff 100%)}
  .card{background:var(--card); border-radius:22px; box-shadow:0 14px 40px rgba(17,23,41,.08)}
  .chip{background:#fff; border-radius:14px; padding:.5rem .8rem; display:inline-flex; gap:.45rem; align-items:center; box-shadow:0 6px 16px rgba(17,23,41,.06)}
  .pill{border-radius:999px}
  .btn{border-radius:18px; font-weight:800; letter-spacing:-.2px}
  .btn-grad{color:#fff; background:linear-gradient(90deg,#4f46e5,#22c8d3); box-shadow:0 10px 18px rgba(79,70,229,.24)}
  .btn-grad:hover{filter:brightness(1.04)}
  .btn-light{background:#fff; border:1px solid #e5e7eb}
  .tab{background:#fff; border:1px solid #eef2ff; border-radius:14px; padding:.55rem 1rem; font-weight:700; color:#334155}
  .tab.active{background:linear-gradient(90deg,#eef2ff,#f0f9ff); color:#111827; box-shadow:0 8px 20px rgba(79,70,229,.12)}
  .stage{
    height:420px; border-radius:20px; position:relative; overflow:hidden;
    background:
      radial-gradient(1200px 280px at 50% 115%, rgba(79,70,229,.15), transparent 60%),
      linear-gradient(180deg,#b9d9ff 0%,#eaf6ff 60%,#f6fbff 100%);
    box-shadow: inset 0 8px 24px rgba(0,0,0,.10);
  }
  .mood{backdrop-filter: blur(8px); background:rgba(255,255,255,.85); border:1px solid rgba(226,232,240,.8)}
  .slot{border:1px dashed #e2e8f0; border-radius:14px; min-height:56px; color:#94a3b8}
  .statbar{height:12px; background:#eef2ff; border-radius:999px; overflow:hidden}
  .statfill{height:100%; border-radius:999px; background:linear-gradient(90deg,#4f46e5,#22c8d3)}
  .pet{width:160px; height:160px; position:absolute; left:50%; transform:translateX(-50%); bottom:54px; cursor:grab; user-select:none}
  .pet svg{filter:drop-shadow(0 14px 18px rgba(15,23,42,.18))}
  .pet.jump{animation:petJump .6s cubic-bezier(.2,.9,.2,1)}
  @keyframes petJump{0%{transform:translate(-50%,0) scale(1)}40%{transform:translate(-50%,-36px) scale(1.04)}100%{transform:translate(-50%,0) scale(1)}}
  .burst{position:absolute; pointer-events:none}
  .particle{position:absolute; width:9px; height:9px; border-radius:2px; opacity:0; transform:translate(-50%,-50%) rotate(0);
            animation:pop 900ms ease-out forwards}
  @keyframes pop{0%{opacity:0; transform:translate(-50%,-50%) scale(.5) rotate(0)} 12%{opacity:1}
                 100%{opacity:0; transform:translate(var(--dx),var(--dy)) scale(1) rotate(360deg)}}
  /* modal */
  .modal-bg{position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; z-index:50}
  .modal{background:#fff; border-radius:24px; box-shadow:0 30px 80px rgba(2,6,23,.35); max-width:880px; width:92%}
</style>
</head>
<body>
<div class="max-w-7xl mx-auto p-5 md:p-8">

  <!-- Top: Title / Level / Points / Tabs -->
  <div class="flex flex-wrap items-center justify-between gap-3 mb-6">
    <div class="flex items-center gap-4">
      <div class="text-2xl md:text-3xl font-extrabold tracking-tight text-indigo-700 flex items-center gap-2">
        <span>🐾 펫 스튜디오</span>
      </div>
      <span class="chip">
        <b class="text-slate-700">푸들 · Lv.<span id="lv">3</span></b>
        <span class="w-36 h-2 bg-slate-200 rounded-full ml-2 overflow-hidden">
          <span id="expbar" class="block h-full rounded-full" style="background:linear-gradient(90deg,#4f46e5,#22c8d3); width:35%"></span>
        </span>
        <span id="exptext" class="text-slate-500 text-sm ml-1">35%</span>
      </span>
    </div>
    <div class="flex items-center gap-2">
      <span class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-4 py-2 rounded-2xl shadow-lg flex items-center gap-2">
        <div class="w-6 h-6 bg-white/20 rounded-full flex items-center justify-center">
          <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
        </div>
        <span class="font-bold">내 포인트 1,240P</span>
      </span>
      <button class="tab active">홈</button>
      <button class="tab">성장</button>
      <button id="invBtn" class="tab">인벤토리</button>
      <button id="shopBtn" class="tab">상점</button>
      <button class="tab">경매</button>
      <button class="tab">기록</button>
    </div>
  </div>

  <div class="grid grid-cols-12 gap-5">
    <!-- Left: Stage -->
    <div class="col-span-12 lg:col-span-8 card p-5">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-extrabold tracking-tight">펫 스테이지</h2>
        <span id="mood" class="mood chip text-sm">기분 😊 <b class="text-slate-800 ml-1">좋음</b></span>
      </div>

      <div id="stage" class="stage">
        <!-- hint -->
        <div class="absolute right-4 top-4 text-[13px] text-slate-600 bg-white/70 px-3 py-1.5 rounded-xl border border-slate-200 shadow-sm">
          드래그/클릭으로 상호작용
        </div>

        <!-- Pet -->
        <div id="pet" class="pet" draggable="true" aria-label="pet">
          <!-- simple inline svg mascot -->
          <svg viewBox="0 0 200 200">
            <defs>
              <linearGradient id="G1" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0" stop-color="#8DE9DB"/>
                <stop offset="1" stop-color="#52D0C7"/>
              </linearGradient>
              <linearGradient id="G2" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0" stop-color="#BFD2FF"/>
                <stop offset="1" stop-color="#7AA3FF"/>
              </linearGradient>
            </defs>
            <!-- head -->
            <g>
              <rect x="28" y="34" rx="22" ry="22" width="144" height="120" fill="url(#G1)" stroke="#0b0b0b" stroke-width="6"/>
              <ellipse cx="44" cy="96" rx="20" ry="26" fill="url(#G1)" stroke="#0b0b0b" stroke-width="6"/>
              <ellipse cx="156" cy="96" rx="20" ry="26" fill="url(#G1)" stroke="#0b0b0b" stroke-width="6"/>
              <rect x="50" y="86" width="100" height="46" rx="16" fill="#E9FFF9" stroke="#0b0b0b" stroke-width="5"/>
              <circle cx="78" cy="106" r="6" fill="#0b0b0b"/>
              <circle cx="122" cy="106" r="6" fill="#0b0b0b"/>
              <path d="M82 124 q18 12 36 0" fill="none" stroke="#0b0b0b" stroke-linecap="round" stroke-width="5"/>
              <rect x="50" y="70" width="100" height="12" rx="6" fill="#FF7EB6" stroke="#0b0b0b" stroke-width="5"/>
            </g>
            <!-- body -->
            <g>
              <rect x="56" y="150" width="88" height="34" rx="12" fill="#fff" stroke="#0b0b0b" stroke-width="5"/>
              <rect x="68" y="184" width="24" height="14" rx="6" fill="#0b0b0b"/>
              <rect x="108" y="184" width="24" height="14" rx="6" fill="#0b0b0b"/>
            </g>
          </svg>
        </div>

        <!-- Slots -->
        <div class="absolute left-5 right-5 bottom-5 grid grid-cols-3 gap-4">
          <div class="slot grid place-items-center text-sm">🍪 먹이 슬롯</div>
          <div class="slot grid place-items-center text-sm">🧸 장난감 슬롯</div>
          <div class="slot grid place-items-center text-sm">🎨 스킨 슬롯</div>
        </div>
      </div>

      <!-- Actions -->
      <div class="mt-5 grid grid-cols-2 md:grid-cols-4 gap-3">
        <button id="feedBtn" class="btn btn-grad py-4 text-[15px]">🍪 먹여주기</button>
        <button id="playBtn" class="btn btn-grad py-4 text-[15px]">🧸 놀아주기</button>
        <button id="trainBtn" class="btn btn-grad py-4 text-[15px]">🏋️ 훈련하기</button>
        <button id="decorBtn" class="btn btn-light py-4 text-[15px]">✨ 꾸미기</button>
      </div>
    </div>

    <!-- Right: Growth / Missions / Log -->
    <div class="col-span-12 lg:col-span-4 card p-5">
      <h2 class="text-lg font-extrabold mb-4">성장 패널</h2>

      <div class="space-y-4">
        <div>
          <div class="flex items-center justify-between text-sm mb-1.5">
            <span class="text-slate-600">집중력</span><b id="statFocusV" class="text-slate-800">40</b>
          </div>
          <div class="statbar"><div id="statFocus" class="statfill" style="width:40%"></div></div>
        </div>
        <div>
          <div class="flex items-center justify-between text-sm mb-1.5">
            <span class="text-slate-600">정확도</span><b id="statAccV" class="text-slate-800">55</b>
          </div>
          <div class="statbar"><div id="statAcc" class="statfill" style="width:55%"></div></div>
        </div>
        <div>
          <div class="flex items-center justify-between text-sm mb-1.5">
            <span class="text-slate-600">속도</span><b id="statSpdV" class="text-slate-800">30</b>
          </div>
          <div class="statbar"><div id="statSpd" class="statfill" style="width:30%"></div></div>
        </div>
      </div>

      <h3 class="text-[15px] font-extrabold mt-6 mb-3">데일리 미션</h3>
      <div class="space-y-2">
        <label class="flex items-center gap-3 px-3 py-2 border rounded-xl">
          <input id="m1" type="checkbox" class="w-5 h-5 accent-indigo-600">
          <span class="flex-1 text-[15px]">먹이 1회 주기</span>
          <span class="text-indigo-600 font-bold">+20P</span>
        </label>
        <label class="flex items-center gap-3 px-3 py-2 border rounded-xl">
          <input id="m2" type="checkbox" class="w-5 h-5 accent-indigo-600">
          <span class="flex-1 text-[15px]">놀아주기 1회</span>
          <span class="text-indigo-600 font-bold">+20P</span>
        </label>
        <label class="flex items-center gap-3 px-3 py-2 border rounded-xl">
          <input id="m3" type="checkbox" class="w-5 h-5 accent-indigo-600">
          <span class="flex-1 text-[15px]">훈련 1회 완료</span>
          <span class="text-indigo-600 font-bold">+30P</span>
        </label>
      </div>

      <h3 class="text-[15px] font-extrabold mt-6 mb-2">최근 로그</h3>
      <div id="log" class="text-[13px] text-slate-600 bg-slate-50/70 rounded-xl p-3 border">
        아직 기록이 없어요.
      </div>
    </div>
  </div>
</div>

<!-- Inventory / Shop Modal -->
<div id="modalBg" class="modal-bg">
  <div class="modal p-5 md:p-6">
    <div class="flex items-center justify-between mb-3">
      <h3 id="modalTitle" class="text-xl font-extrabold">인벤토리</h3>
      <button id="closeModal" class="tab">닫기</button>
    </div>
    <div id="modalBody" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
  </div>
</div>

<script>
  // --------- STATE ---------
  const state = {
    level: 3, exp: 35, points: 1240,
    mood: '좋음', moodEmoji:'😊',
    stats:{ focus:40, acc:55, spd:30 },
    log: [],
    inv:{ food:2, toy:1, skin:0 },
    shop:[
      {id:'food1', kind:'food', name:'펫 먹이 · 별사탕', price:120, tag:'COMMON', color:'#f9a8d4'},
      {id:'toy1',  kind:'toy',  name:'펫 장난감 · 요요', price:160, tag:'COMMON', color:'#93c5fd'},
      {id:'skin1', kind:'skin', name:'스킨 · 민트 오라', price:520, tag:'RARE',   color:'#6ee7b7'},
    ]
  };

  // --------- DOM ---------
  const $points = document.getElementById('points');
  const $expbar = document.getElementById('expbar');
  const $exptext = document.getElementById('exptext');
  const $mood = document.getElementById('mood');
  const $pet = document.getElementById('pet');
  const $stage = document.getElementById('stage');
  const $log = document.getElementById('log');
  const $modalBg = document.getElementById('modalBg');
  const $modalTitle = document.getElementById('modalTitle');
  const $modalBody = document.getElementById('modalBody');

  // --------- UTIL ---------
  const fmtP = n => n.toLocaleString()+'P';
  const clamp = (n,min,max)=>Math.max(min,Math.min(max,n));

  function updateTop(){
    $points.textContent = fmtP(state.points);
    $expbar.style.width = state.exp + '%';
    $exptext.textContent = state.exp + '%';
    $mood.innerHTML = `기분 ${state.moodEmoji} <b class="text-slate-800 ml-1">${state.mood}</b>`;
    // stats
    setBar('Focus', state.stats.focus);
    setBar('Acc', state.stats.acc);
    setBar('Spd', state.stats.spd);
  }
  function setBar(key, v){
    document.getElementById('stat'+key).style.width = v+'%';
    document.getElementById('stat'+key+'V').textContent = v;
  }
  function pushLog(txt){
    state.log.unshift(txt);
    $log.innerHTML = state.log.slice(0,6).map(x=>`• ${x}`).join('<br/>');
  }

  // --------- PARTICLES ---------
  const COLORS = ['#ff6aa8','#4f46e5','#22c8d3','#f59e0b','#10b981','#06b6d4'];
  function burstAt(x,y, parent){
    const root = document.createElement('div');
    root.className='burst'; root.style.left=x+'px'; root.style.top=y+'px';
    root.style.position='absolute';
    parent.appendChild(root);
    for(let i=0;i<20;i++){
      const p=document.createElement('div'); p.className='particle';
      const ang = (Math.PI*2)*(i/20); const dist= 80 + Math.random()*40;
      p.style.setProperty('--dx', Math.cos(ang)*dist+'px');
      p.style.setProperty('--dy', Math.sin(ang)*dist*-1+'px');
      p.style.background = COLORS[Math.floor(Math.random()*COLORS.length)];
      root.appendChild(p);
    }
    setTimeout(()=>root.remove(), 900);
  }

  // --------- ACTIONS ---------
  function spendPoint(n){ state.points = clamp(state.points - n, 0, 1e9); updateTop(); }

  document.getElementById('feedBtn').onclick = ()=>{
    if(state.inv.food<=0){ toast('먹이가 없어요. 상점에서 구매해요!'); return; }
    state.inv.food--; state.stats.acc = clamp(state.stats.acc+3, 0, 100);
    state.mood = '아주 좋음'; state.moodEmoji='😋';
    pushLog('먹이를 주었어요. 정확도 +3');
    animatePet('heart');
    updateTop();
    // 미션 체크 자동
    document.getElementById('m1').checked = true; rewardMission(20);
  };

  document.getElementById('playBtn').onclick = ()=>{
    if(state.inv.toy<=0){ toast('장난감이 없어요. 상점에서 구매해요!'); return; }
    state.stats.focus = clamp(state.stats.focus+4,0,100);
    state.mood='행복'; state.moodEmoji='😄';
    pushLog('놀아주었어요. 집중력 +4');
    animatePet('sparkle');
    updateTop();
    document.getElementById('m2').checked = true; rewardMission(20);
  };

  document.getElementById('trainBtn').onclick = ()=>{
    state.stats.spd = clamp(state.stats.spd+5,0,100);
    state.exp = clamp(state.exp+5,0,100);
    state.mood='활기참'; state.moodEmoji='🤩';
    pushLog('훈련 완료! 속도 +5 · EXP +5%');
    animatePet('jump');
    updateTop();
    document.getElementById('m3').checked = true; rewardMission(30);
  };

  document.getElementById('decorBtn').onclick = ()=>{
    toast('꾸미기: 곧 다양한 스킨/액세서리를 지원합니다!');
  };

  // --------- MISSIONS ---------
  function rewardMission(p){
    state.points += p; updateTop();
    const r = $stage.getBoundingClientRect();
    burstAt(r.width/2, 120, $stage);
  }
  ['m1','m2','m3'].forEach(id=>{
    document.getElementById(id).addEventListener('change', e=>{
      if(e.target.checked){
        const add = id==='m3'?30:20;
        state.points += add; updateTop();
        const r = $stage.getBoundingClientRect();
        burstAt(r.width/2, 100, $stage);
        pushLog(`데일리 미션 보상 +${add}P`);
      }
    });
  });

  // --------- PET INTERACTION ---------
  function animatePet(kind){
    if(kind==='jump'){ $pet.classList.add('jump'); setTimeout(()=> $pet.classList.remove('jump'), 600); }
    const rect = $stage.getBoundingClientRect();
    const x = rect.width/2, y = rect.height/2;
    burstAt(x, y, $stage);
  }
  $pet.addEventListener('click', ()=>{ animatePet('jump'); });

  // drag (only visual)
  $pet.addEventListener('dragstart', e=>{ e.dataTransfer.setDragImage(new Image(),0,0); $pet.style.opacity='.85'; });
  $pet.addEventListener('dragend', e=>{ $pet.style.opacity='1'; animatePet('jump'); });

  // --------- INVENTORY & SHOP ---------
  const invBtn = document.getElementById('invBtn');
  const shopBtn = document.getElementById('shopBtn');
  const closeModal = document.getElementById('closeModal');

  invBtn.onclick = ()=> openModal('인벤토리', renderInventory);
  shopBtn.onclick = ()=> openModal('상점', renderShop);
  closeModal.onclick = ()=> $modalBg.style.display='none';
  $modalBg.addEventListener('click', (e)=>{ if(e.target === $modalBg) $modalBg.style.display='none'; });

  function openModal(title, renderFn){
    $modalTitle.textContent = title;
    $modalBody.innerHTML = '';
    renderFn();
    $modalBg.style.display='flex';
  }

  function itemCard({title, sub, color, qty, price, buttons}){
    const div = document.createElement('div');
    div.className = 'card p-4 flex flex-col gap-3';
    div.innerHTML = `
      <div class="flex items-center gap-3">
        <div class="w-11 h-11 rounded-xl" style="background:${color}"></div>
        <div class="flex-1">
          <div class="font-extrabold">${title}</div>
          <div class="text-sm text-slate-500">${sub}</div>
        </div>
        ${qty!=null? `<span class="chip">보유 <b class="ml-1">${qty}</b></span>`:''}
        ${price!=null? `<span class="chip">가격 <b class="ml-1">${price}P</b></span>`:''}
      </div>
      <div class="flex gap-2">${buttons}</div>
    `;
    return div;
  }

  function renderInventory(){
    const items = [
      itemCard({
        title:'펫 먹이 · 별사탕',
        sub:'먹이면 정확도 UP',
        color:'#fbcfe8',
        qty: state.inv.food,
        buttons:`<button class="btn btn-grad px-4 py-2" id="useFood">사용</button>`
      }),
      itemCard({
        title:'펫 장난감 · 요요',
        sub:'놀아주면 집중력 UP',
        color:'#bfdbfe',
        qty: state.inv.toy,
        buttons:`<button class="btn btn-grad px-4 py-2" id="useToy">사용</button>`
      }),
      itemCard({
        title:'스킨 · 민트 오라',
        sub:'꾸미기 아이템',
        color:'#a7f3d0',
        qty: state.inv.skin,
        buttons:`<button class="btn btn-light px-4 py-2" disabled>장착(준비중)</button>`
      }),
    ];
    items.forEach(el=> $modalBody.appendChild(el));
    document.getElementById('useFood').onclick = ()=>{ $modalBg.style.display='none'; document.getElementById('feedBtn').click(); };
    document.getElementById('useToy').onclick  = ()=>{ $modalBg.style.display='none'; document.getElementById('playBtn').click(); };
  }

  function renderShop(){
    state.shop.forEach(item=>{
      const el = itemCard({
        title:item.name,
        sub:item.tag,
        color:item.color,
        price:item.price,
        buttons:`<button class="btn btn-grad px-4 py-2" data-id="${item.id}">구매</button>`
      });
      $modalBody.appendChild(el);
    });
    $modalBody.querySelectorAll('button[data-id]').forEach(btn=>{
      btn.onclick = ()=>{
        const id = btn.getAttribute('data-id');
        const it = state.shop.find(x=>x.id===id);
        if(state.points < it.price){ toast('포인트가 부족해요!'); return; }
        spendPoint(it.price);
        state.inv[it.kind] = (state.inv[it.kind]||0)+1;
        pushLog(`상점에서 "${it.name}" 구매 (+1)`);
        toast('구매 완료!');
        renderShop(); // refresh
      };
    });
  }

  // --------- TOAST ---------
  function toast(msg){
    const t = document.createElement('div');
    t.className='fixed left-1/2 -translate-x-1/2 bottom-6 z-50 px-4 py-2 rounded-xl text-white font-bold';
    t.style.background='linear-gradient(90deg,#4f46e5,#22c8d3)';
    t.textContent = msg;
    document.body.appendChild(t);
    setTimeout(()=>{ t.style.transition='opacity .4s'; t.style.opacity='0'; }, 1100);
    setTimeout(()=> t.remove(), 1600);
  }

  // init
  updateTop();
</script>
</body>
</html>
